<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NFL Win Projection Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="dark light" />
    <link rel="stylesheet" href="styles.css" />
    <!-- Optional: betting-specific styles if still separate -->
    <link rel="stylesheet" href="betting.css" />
  </head>

  <!-- Start in dark + desktop mode; JS will adjust -->
  <body class="theme-dark mode-desktop">
    <!-- Top bar ------------------------------------------------------------ -->
    <header class="app-header">
      <div class="app-title">
        <h1>NFL Win Projection Tool</h1>
        <p>Weeks 15–18, 2025 · Spread-based probabilities (home perspective)</p>
      </div>

      <!-- Header-controls toggle (only visible in mobile via CSS) -->
      <button
        id="headerControlsToggle"
        type="button"
        class="btn secondary header-toggle-btn"
        aria-expanded="false"
        aria-controls="headerControlsBar"
      >
        Show Header Controls
      </button>

      <!-- Main header controls -->
      <div
        id="headerControlsBar"
        class="app-controls header-controls"
        aria-label="Global controls"
      >
        <!-- Theme toggle -->
        <button id="themeToggle" type="button" class="btn secondary">
          Switch to Light Theme
        </button>

        <!-- Desktop vs Mobile display (uses body.mode-desktop / body.mode-mobile) -->
        <button
          id="mainDisplayModeToggle"
          type="button"
          class="btn secondary"
        >
          Switch to Mobile View
        </button>

        <!-- Fan vs Pro mode (column presets + styling) -->
        <button id="modeToggleBtn" type="button" class="btn secondary">
          Switch to Pro Mode
        </button>

        <!-- View toggle: schedule vs projections -->
        <button id="viewToggleBtn" type="button" class="btn secondary">
          Show Team Projections
        </button>

        <!-- Toggle implied odds on game cards -->
        <button id="toggleOddsBtn" type="button" class="btn secondary">
          Show Implied Odds
        </button>

        <!-- Precision select -->
        <label class="control-group" for="precisionSelect">
          <span>Display precision</span>
          <select id="precisionSelect">
            <option value="2" selected>2 decimals</option>
            <option value="3">3 decimals</option>
            <option value="4">4 decimals</option>
          </select>
        </label>

        <!-- Fill neutrals -->
        <button id="fillEvenBtn" type="button" class="btn secondary">
          Fill empty games with neutral spread
        </button>

        <!-- Reset -->
        <button id="resetStateBtn" type="button" class="btn danger">
          Reset all spreads
        </button>

        <!-- Export -->
        <button id="exportCSV" type="button" class="btn primary">
          Export projections as CSV
        </button>
      </div>
    </header>

    <!-- Main content ------------------------------------------------------- -->
    <main class="layout">
      <!-- Schedule / spreads ---------------------------------------------- -->
      <section id="scheduleSection" class="schedule-section">
        <h2>Schedule &amp; Spread Inputs</h2>
        <p class="section-note">
          Spreads are always from the <strong>home team's perspective</strong>.
          Click on a number in the spread band to set the line for that game.
        </p>

        <!-- Progress UI (wired by updateProgressUI in app.js) -->
        <div class="section-note">
          <div id="step1ProgressText">
            Games with your line: 0/64 (0%)
          </div>
          <div id="step2ProgressText">
            Teams touched: 0/32 (0%)
          </div>
          <div id="step3ProgressText">
            Set some spreads to unlock betting edges
          </div>

          <div
            style="
              margin-top: 0.4rem;
              width: 100%;
              max-width: 420px;
              height: 8px;
              border-radius: 999px;
              background: rgba(148, 163, 184, 0.35);
              overflow: hidden;
            "
          >
            <div
              id="globalProgressBar"
              style="
                width: 0%;
                height: 100%;
                border-radius: inherit;
                background: linear-gradient(90deg, #22c55e, #0ea5e9);
                transition: width 0.18s ease;
              "
            ></div>
          </div>
          <div
            id="globalProgressLabel"
            style="margin-top: 0.2rem; font-size: 0.85rem; opacity: 0.85;"
          >
            0% complete
          </div>
        </div>

        <!-- Filters for week / team / division / pick status -->
        <div class="app-controls schedule-filters">
          <label class="control-group" for="filterWeek">
            <span>Week</span>
            <select id="filterWeek"></select>
          </label>

          <label class="control-group" for="filterTeam">
            <span>Team</span>
            <select id="filterTeam"></select>
          </label>

          <label class="control-group" for="filterDivision">
            <span>Division</span>
            <select id="filterDivision"></select>
          </label>

          <label class="control-group" for="filterPickStatus">
            <span>Pick status</span>
            <select id="filterPickStatus"></select>
          </label>
        </div>

        <!-- Scenario controls (wired by initScenarioControls in app.js) -->
        <div class="app-controls" style="margin-top: 0.6rem;">
          <label class="control-group" for="scenarioSelect">
            <span>Saved scenarios</span>
            <select id="scenarioSelect">
              <!-- options injected by JS -->
            </select>
          </label>

          <label class="control-group" for="scenarioNameInput">
            <span>Name</span>
            <input
              id="scenarioNameInput"
              type="text"
              placeholder="e.g. Chalk, Upsets, Favorites"
              style="
                padding: 0.35rem 0.8rem;
                border-radius: 999px;
                border: 1px solid currentColor;
                font-size: 0.9rem;
              "
            />
          </label>

          <button id="scenarioSaveBtn" type="button" class="btn secondary">
            Save scenario
          </button>

          <button id="scenarioDeleteBtn" type="button" class="btn danger">
            Delete scenario
          </button>
        </div>

        <!-- Game cards are injected here by app.js -->
        <div id="scheduleContainer" class="schedule-container"></div>
      </section>

      <!-- Projections view (hidden by default, toggled in JS) -------------- -->
      <section id="resultsSection" class="results-section hidden">
        <div class="results-header-row">
          <h2>Team Projections</h2>

          <button
            id="toggleColumnPicker"
            type="button"
            class="btn secondary results-columns-btn"
          >
            Columns
          </button>
        </div>

        <div id="divisionNote" class="division-note"></div>

        <!-- Column selection panel (options injected in JS) -->
        <div id="columnPicker" class="column-picker hidden"></div>

        <!-- Main projections table (injected in JS) -->
        <div id="teamTableContainer" class="table-container"></div>

        <h3>Division Summaries</h3>
        <div
          id="divisionSummaryContainer"
          class="division-summary-container"
        ></div>
      </section>

      <!-- Betting view (inline, used when Betting tab is active) ----------- -->
      <section id="bettingSection" class="results-section hidden">
        <div class="results-header-row">
          <h2>Betting Edges</h2>
          <button
            id="betToggleColumns"
            type="button"
            class="btn secondary results-columns-btn"
          >
            Columns
          </button>
        </div>

        <p id="betStatusNote" class="section-note">
          Run a projection first, then come back here to see edges vs the
          market.
        </p>

        <div id="betColumnPicker" class="column-picker hidden"></div>

        <!-- Main betting EV table -->
        <div id="betTableContainer" class="table-container"></div>
      </section>

      <!-- Optional raw markets table under betting ------------------------- -->
      <section id="rawMarketsSection" class="results-section hidden">
        <div class="results-header-row">
          <h2>Market Win Totals</h2>
        </div>
        <p class="section-note">
          These are the raw win totals and odds from the book side, without your
          model applied.
        </p>

        <div id="rawMarketsContainer" class="table-container"></div>
      </section>
    </main>

    <!-- Team detail modal -------------------------------------------------- -->
    <div
      id="teamDetailOverlay"
      class="team-detail-overlay hidden"
      aria-hidden="true"
    >
      <div
        class="team-detail-modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="teamDetailTitle"
      >
        <button
          id="teamDetailClose"
          class="btn close-btn"
          type="button"
          aria-label="Close team detail"
        >
          ×
        </button>
        <div id="teamDetailContent"></div>
      </div>
    </div>

    <!-- Betting detail drawer (for betting table rows) --------------------- -->
    <div
      id="betDetailOverlay"
      class="team-detail-overlay hidden"
      aria-hidden="true"
    >
      <div
        class="team-detail-modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="betDetailTitle"
      >
        <button
          id="betDetailClose"
          class="btn close-btn"
          type="button"
          aria-label="Close betting detail"
        >
          ×
        </button>
        <div id="betDetailContent"></div>
      </div>
    </div>

    <!-- Bottom tab bar – mobile-first fan navigation ---------------------- -->
    <nav class="bottom-nav" aria-label="Primary navigation">
      <button
        class="bottom-nav-item is-active"
        data-tab="games"
        type="button"
      >
        <span class="bottom-nav-label">Games</span>
      </button>

      <button class="bottom-nav-item" data-tab="teams" type="button">
        <span class="bottom-nav-label">Teams</span>
      </button>

      <button class="bottom-nav-item" data-tab="betting" type="button">
        <span class="bottom-nav-label">Betting</span>
      </button>

      <button class="bottom-nav-item" data-tab="more" type="button">
        <span class="bottom-nav-label">More</span>
      </button>
    </nav>

    <!-- Main app + betting logic -->
    <script src="shared.js"></script>
    <script src="app.js"></script>
    <script src="betting.js"></script>
  </body>
</html>
