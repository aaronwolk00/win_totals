<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NFL Win Projection Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="dark light" />

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="betting.css" />
  </head>

  <body class="theme-dark mode-desktop">
    <!-- HEADER -->
    <header class="app-header">
      <div class="app-title">
        <h1>NFL Win Projection Tool</h1>
        <p>Weeks 15–18, 2025 · Spread-based probabilities (home perspective)</p>
      </div>

      <button
        id="headerControlsToggle"
        type="button"
        class="btn secondary header-toggle-btn"
        aria-expanded="false"
        aria-controls="headerControlsBar"
      >
        Show Header Controls
      </button>

      <div id="headerControlsBar" class="app-controls header-controls">
        <button id="themeToggle" type="button" class="btn secondary">
          Switch to Light Theme
        </button>
        <button id="mainDisplayModeToggle" type="button" class="btn secondary">
          Switch to Mobile View
        </button>
        <button id="modeToggleBtn" type="button" class="btn secondary">
          Switch to Pro Mode
        </button>
        <button id="viewToggleBtn" type="button" class="btn secondary">
          Show Team Projections
        </button>
        <button id="toggleOddsBtn" type="button" class="btn secondary">
          Show Implied Odds
        </button>
        <label class="control-group" for="precisionSelect">
          <span>Display precision</span>
          <select id="precisionSelect">
            <option value="2" selected>2 decimals</option>
            <option value="3">3 decimals</option>
            <option value="4">4 decimals</option>
          </select>
        </label>
        <button id="fillEvenBtn" type="button" class="btn secondary">
          Fill empty games with neutral spread
        </button>
        <button id="resetStateBtn" type="button" class="btn danger">
          Reset all spreads
        </button>
        <button id="exportCSV" type="button" class="btn primary">
          Export projections as CSV
        </button>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="layout">
      <!-- Schedule -->
      <section id="scheduleSection" class="schedule-section">
        <h2>Schedule &amp; Spread Inputs</h2>
        <p class="section-note">
          Spreads are always from the <strong>home team's perspective</strong>.
          Click a number in the spread band to set the line for that game.
        </p>

        <!-- Progress -->
        <div class="section-note">
          <div id="step1ProgressText">Games with your line: 0/64 (0%)</div>
          <div id="step2ProgressText">Teams touched: 0/32 (0%)</div>
          <div id="step3ProgressText">Set some spreads to unlock betting edges</div>
          <div class="progress-bar-bg">
            <div id="globalProgressBar" class="progress-bar-fill"></div>
          </div>
          <div id="globalProgressLabel" class="progress-label">0% complete</div>
        </div>

        <!-- Filters -->
        <div class="app-controls schedule-filters">
          <label class="control-group" for="filterWeek">
            <span>Week</span>
            <select id="filterWeek"></select>
          </label>
          <label class="control-group" for="filterTeam">
            <span>Team</span>
            <select id="filterTeam"></select>
          </label>
          <label class="control-group" for="filterDivision">
            <span>Division</span>
            <select id="filterDivision"></select>
          </label>
          <label class="control-group" for="filterPickStatus">
            <span>Pick status</span>
            <select id="filterPickStatus"></select>
          </label>
        </div>

        <!-- Scenarios -->
        <div class="app-controls" style="margin-top: 0.6rem;">
          <label class="control-group" for="scenarioSelect">
            <span>Saved scenarios</span>
            <select id="scenarioSelect"></select>
          </label>
          <label class="control-group" for="scenarioNameInput">
            <span>Name</span>
            <input
              id="scenarioNameInput"
              type="text"
              placeholder="e.g. Chalk, Upsets, Favorites"
            />
          </label>
          <button id="scenarioSaveBtn" type="button" class="btn secondary">
            Save scenario
          </button>
          <button id="scenarioDeleteBtn" type="button" class="btn danger">
            Delete scenario
          </button>
        </div>

        <div id="scheduleContainer" class="schedule-container"></div>
      </section>

      <!-- Projections -->
      <section id="resultsSection" class="results-section hidden">
        <div class="results-header-row">
          <h2>Team Projections</h2>
          <button id="toggleColumnPicker" class="btn secondary">Columns</button>
        </div>
        <div id="divisionNote" class="division-note"></div>
        <div id="columnPicker" class="column-picker hidden"></div>
        <div id="teamTableContainer" class="table-container"></div>
        <h3>Division Summaries</h3>
        <div id="divisionSummaryContainer" class="division-summary-container"></div>
      </section>

      <!-- Betting -->
      <section id="bettingSection" class="results-section hidden">
        <div class="results-header-row">
          <div>
            <h2>Betting Table (Additional Wins vs Market)</h2>
            <p class="section-note">
              Click a row to see full market details, implied probabilities, and Kelly stakes.
            </p>
          </div>
          <div class="results-header-actions">
            <button
              id="betModeToggle"
              type="button"
              class="btn secondary"
            >
              Switch to Pro Mode
            </button>
            <button
              id="betToggleColumns"
              type="button"
              class="btn secondary results-columns-btn"
            >
              Columns
            </button>
          </div>
        </div>

        <p id="betStatusNote" class="section-note" aria-live="polite">
          Loading simulation results from local storage…
        </p>

        <!-- Filters / settings row -->
        <div class="app-controls controls-row" style="margin-top: 0.4rem;">
          <label class="control-group">
            <span>Division</span>
            <select id="betDivisionFilter">
              <option value="ALL">All</option>
              <option value="AE">AE</option>
              <option value="AW">AW</option>
              <option value="AN">AN</option>
              <option value="AS">AS</option>
              <option value="NE">NE</option>
              <option value="NN">NN</option>
              <option value="NS">NS</option>
              <option value="NW">NW</option>
            </select>
          </label>

          <label class="control-group checkbox-group">
            <input id="betPositiveEVOnly" type="checkbox" />
            <span>Only teams with any positive EV</span>
          </label>

          <label class="control-group">
            <span>Min EV ($)</span>
            <input
              id="betMinEV"
              type="number"
              min="0"
              step="1"
              placeholder="0"
            />
          </label>

          <label class="control-group">
            <span>Min edge (%)</span>
            <input
              id="betMinEdge"
              type="number"
              min="0"
              step="0.1"
              placeholder="0"
            />
          </label>
        </div>

        <div class="app-controls controls-row">
          <label class="control-group">
            <span>Bankroll ($)</span>
            <input
              id="betBankroll"
              type="number"
              min="1"
              step="50"
              placeholder="1000"
            />
          </label>

          <label class="control-group">
            <span>Kelly fraction (%)</span>
            <input
              id="betKellyFraction"
              type="number"
              min="0"
              max="100"
              step="5"
              placeholder="25"
            />
          </label>

          <button
            id="betExportBtn"
            type="button"
            class="btn primary"
            style="margin-left: auto;"
          >
            Export CSV
          </button>

          <p class="section-note" style="margin-left: auto; max-width: 22rem;">
            Bankroll and Kelly fraction are used only for suggested stake sizing in the
            team detail view. They do not affect the EV numbers.
          </p>
        </div>

        <!-- Column selection panel -->
        <div id="betColumnPicker" class="column-picker hidden"></div>

        <!-- Main betting table -->
        <div id="betTableContainer" class="table-container"></div>
      </section>

      <section id="rawMarketsSection" class="results-section hidden">
        <div class="results-header-row">
          <h2>Market Win Totals</h2>
        </div>
        <div id="rawMarketsContainer" class="table-container"></div>
      </section>
    </main>

    <!-- MODALS -->
    <div id="teamDetailOverlay" class="team-detail-overlay hidden">
      <div class="team-detail-modal">
        <button id="teamDetailClose" class="btn close-btn">×</button>
        <div id="teamDetailContent"></div>
      </div>
    </div>

    <div id="betDetailOverlay" class="team-detail-overlay hidden">
      <div class="team-detail-modal">
        <button id="betDetailClose" class="btn close-btn">×</button>
        <div id="betDetailContent"></div>
      </div>
    </div>

    <!-- NAV -->
    <nav class="bottom-nav">
      <button class="bottom-nav-item is-active" data-tab="games">
        <span class="bottom-nav-label">Games</span>
      </button>
      <button class="bottom-nav-item" data-tab="teams">
        <span class="bottom-nav-label">Teams</span>
      </button>
      <button class="bottom-nav-item" data-tab="betting">
        <span class="bottom-nav-label">Betting</span>
      </button>
      <button class="bottom-nav-item" data-tab="more">
        <span class="bottom-nav-label">More</span>
      </button>
    </nav>

    <!-- SCRIPTS -->
    <script src="shared.js"></script>
    <script src="app.js"></script>
    <script src="betting.js"></script>
  </body>
</html>
